!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TurboFlow=e()}(this,function(){"use strict";class t{constructor(t={}){this.defaults={defaultTransition:"fade",duration:300,easing:"ease-out",debug:!1,autoInject:!0,reducedMotion:"respect",prefersReducedMotionFallback:"none",cleanupInterval:5e3,frames:{},streams:{append:"fade-up",prepend:"fade-down",replace:"morph",update:"morph",remove:"fade-out",before:"slide-right",after:"slide-left"},targets:{},customAnimations:{}},this.config=this.merge(this.defaults,t),this.listeners=new Set}merge(t,e){const n={...t};for(const r in e)e[r]&&"object"==typeof e[r]&&!Array.isArray(e[r])?n[r]=this.merge(t[r]||{},e[r]):n[r]=e[r];return n}get(t=null){if(!t)return this.config;const e=t.split(".");let n=this.config;for(const r of e)if(n=n[r],void 0===n)return;return n}set(t,e){const n=t.split("."),r=n.pop();let i=this.config;for(const s of n)i[s]&&"object"==typeof i[s]||(i[s]={}),i=i[s];const o=i[r];return i[r]=e,this.notifyListeners(t,e,o),this}update(t){const e={...this.config};return this.config=this.merge(this.config,t),this.notifyListeners("*",this.config,e),this}reset(t={}){const e={...this.config};return this.config=this.merge(this.defaults,t),this.notifyListeners("reset",this.config,e),this}getTransitionForElement(t){return t?t.dataset.turboFlow?t.dataset.turboFlow:t.dataset.turboFlowTarget?t.dataset.turboFlowTarget:"TURBO-FRAME"===t.tagName&&t.id&&this.config.frames[t.id]||this.config.defaultTransition:this.config.defaultTransition}getStreamTransition(t){return this.config.streams[t]||this.config.defaultTransition}getFrameTransition(t){return this.config.frames[t]||this.config.defaultTransition}shouldAnimate(){if(!this.config.autoInject)return!1;if("respect"===this.config.reducedMotion){return!window.matchMedia("(prefers-reduced-motion: reduce)").matches}return"disable"!==this.config.reducedMotion}getReducedMotionFallback(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches&&"respect"===this.config.reducedMotion?this.config.prefersReducedMotionFallback:null}addListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t,e,n){this.listeners.forEach(r=>{try{r(t,e,n)}catch(i){this.config.debug&&console.error("Config listener error:",i)}})}validate(){const t=[];("number"!=typeof this.config.duration||this.config.duration<0)&&t.push("Duration must be a positive number"),("number"!=typeof this.config.cleanupInterval||this.config.cleanupInterval<0)&&t.push("Cleanup interval must be a positive number");const e=["respect","disable","force"];return e.includes(this.config.reducedMotion)||t.push(`Reduced motion must be one of: ${e.join(", ")}`),t.length>0?t:null}export(){return JSON.parse(JSON.stringify(this.config))}import(t){const e=this.validate();if(e)throw new Error(`Invalid configuration: ${e.join("; ")}`);return this.update(t),this}}class e{constructor(){this.animations=new Map,this.keyframes=new Map}register(t,e){if(!t||!e)throw new Error("Animation name and definition are required");return this.animations.set(t,{...e,name:t,keyframes:e.keyframes||{},duration:e.duration||300,easing:e.easing||"ease-out"}),this}get(t){return this.animations.get(t)}has(t){return this.animations.has(t)}generateCSS(t,e={}){var n;const r=this.get(t);if(!r)return console.warn(`Animation "${t}" not found`),"";const i=e.duration||r.duration,o=e.easing||r.easing,s=`turbo-flow-${t}-${Date.now()}`,a=(null==(n=r.viewTransitions)?void 0:n.new)||{from:{},to:{}};return{keyframeCSS:this.generateKeyframes(s,a),animationCSS:`${s} ${i}ms ${o}`,keyframeName:s}}generateKeyframes(t,e){return`@keyframes ${t} { ${Object.entries(e).map(([t,e])=>`${t} { ${Object.entries(e).map(([t,e])=>`${this.kebabCase(t)}: ${e};`).join(" ")} }`).join(" ")} }`}generateViewTransitionCSS(t,e="forward"){const n=this.get(t);if(!n)return"";let r=n.viewTransitions;n.directions&&n.directions[e]&&(r=n.directions[e]);const{old:i,new:o}=r||{};if(!i||!o)return"";return`\n      ${this.generateKeyframes(`turbo-flow-${t}-old-${e}`,i)}\n      ${this.generateKeyframes(`turbo-flow-${t}-new-${e}`,o)}\n      ::view-transition-old(turbo-flow-${t}) {\n        animation: turbo-flow-${t}-old-${e} ${n.duration}ms ${n.easing};\n      }\n      ::view-transition-new(turbo-flow-${t}) {\n        animation: turbo-flow-${t}-new-${e} ${n.duration}ms ${n.easing};\n      }\n    `}kebabCase(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}list(){return Array.from(this.animations.keys())}clear(){this.animations.clear(),this.keyframes.clear()}}class n{constructor(){this.cache=new Map,this.listeners=new Map,this.defaultTransition=null}scan(t=document){const e={links:[],forms:[],frames:[],targets:[]};t.querySelectorAll("a[data-turbo-flow], a[data-turbo-flow-target]").forEach(t=>{const n=t.dataset.turboFlow,r=t.dataset.turboFlowTarget;n&&e.links.push({element:t,transition:n,href:t.href}),r&&e.targets.push({element:t,transition:r,id:t.id})});t.querySelectorAll("form[data-turbo-flow]").forEach(t=>{e.forms.push({element:t,transition:t.dataset.turboFlow,successTransition:t.dataset.turboFlowSuccess,errorTransition:t.dataset.turboFlowError,action:t.action,method:t.method})});t.querySelectorAll("turbo-frame[data-turbo-flow]").forEach(t=>{e.frames.push({element:t,transition:t.dataset.turboFlow,id:t.id})});return t.querySelectorAll("[data-turbo-flow-target]").forEach(t=>{t.matches("a, form, turbo-frame")||e.targets.push({element:t,transition:t.dataset.turboFlowTarget,id:t.id})}),this.cache.set(t,e),e}findTransition(t){var e;if(!t)return this.defaultTransition;const n=null==(e=t.dataset)?void 0:e.turboFlow;if(n)return n;const r=t.closest("a[data-turbo-flow]");if(r)return r.dataset.turboFlow;const i=t.closest("form[data-turbo-flow]");return i?i.dataset.turboFlow:this.defaultTransition}attachListeners(){const t=t=>{const e=t.target.closest("a[data-turbo-flow]");if(e){const n=e.dataset.turboFlow;this.notifyListeners("link:click",{element:e,transition:n,event:t})}},e=t=>{const e=t.target;if(e.matches("form[data-turbo-flow]")){const n=e.dataset.turboFlow;this.notifyListeners("form:submit",{element:e,transition:n,event:t})}},n=t=>{const e=this.findTransition(t.target);this.notifyListeners("turbo:before-render",{transition:e,event:t})},r=t=>{var e;const n=t.target,r=(null==(e=n.dataset)?void 0:e.turboFlow)||this.defaultTransition;this.notifyListeners("turbo:before-frame-render",{element:n,transition:r,event:t})};document.addEventListener("click",t),document.addEventListener("submit",e),document.addEventListener("turbo:before-render",n),document.addEventListener("turbo:before-frame-render",r),this.cleanup=()=>{document.removeEventListener("click",t),document.removeEventListener("submit",e),document.removeEventListener("turbo:before-render",n),document.removeEventListener("turbo:before-frame-render",r)}}on(t,e){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),()=>{var n;null==(n=this.listeners.get(t))||n.delete(e)}}notifyListeners(t,e){const n=this.listeners.get(t);n&&n.forEach(t=>t(e))}setDefaultTransition(t){this.defaultTransition=t}clearCache(){this.cache.clear()}clear(){this.cache.clear(),this.listeners.clear(),this.cleanup&&this.cleanup()}getCached(t=document){return this.cache.get(t)}}class r{constructor(t){this.registry=t,this.generated=new Map,this.viewTransitionNames=new Set}generate(t){const e=[],n=new Set;return t.links&&t.links.forEach(t=>{this.generateTransitionCSS(t.transition,e,n)}),t.forms&&t.forms.forEach(t=>{this.generateTransitionCSS(t.transition,e,n),t.successTransition&&this.generateTransitionCSS(t.successTransition,e,n)}),t.frames&&t.frames.forEach(t=>{this.generateTransitionCSS(t.transition,e,n,t.id)}),t.targets&&t.targets.forEach(t=>{this.generateElementTransitionCSS(t,e)}),e.join("\n")}generateTransitionCSS(t,e,n,r=null){if(!t||n.has(t))return;const i=this.registry.get(t);if(!i)return;n.add(t);const o=i.directions||{},s=o.forward||o.back||o.none;o.forward&&e.push(this.generateDirectionalCSS(t,"forward",o.forward,i)),o.back&&e.push(this.generateDirectionalCSS(t,"back",o.back,i)),o.none&&e.push(this.generateDirectionalCSS(t,"none",o.none,i)),i.viewTransitions&&!s&&e.push(this.generateDirectionalCSS(t,"none",i.viewTransitions,i))}generateDirectionalCSS(t,e,n,r){const{old:i,new:o}=n;if(!i||!o)return"";const s=`turbo-flow-${t}-old-${e}`,a=`turbo-flow-${t}-new-${e}`,c=this.generateKeyframes(s,i),l=this.generateKeyframes(a,o),d=r.duration||300,u=r.easing||"ease-out";let f="";return f="forward"===e?`html.turboflow-${t}[data-turbo-visit-direction="forward"]`:"back"===e?`html.turboflow-${t}[data-turbo-visit-direction="back"]`:`html.turboflow-${t}:not([data-turbo-visit-direction])`,`\n      ${c}\n      ${l}\n      ${f}::view-transition-old(root) {\n        animation: ${s} ${d}ms ${u};\n      }\n      ${f}::view-transition-new(root) {\n        animation: ${a} ${d}ms ${u};\n      }\n    `}generateElementTransitionCSS(t,e){if(!t.id||!t.transition)return;if("morph"===t.transition){const n=`turbo-flow-morph-${t.id}`;return this.viewTransitionNames.add(n),void e.push(`\n        #${t.id} {\n          view-transition-name: ${n};\n        }\n      `)}const n=this.registry.get(t.transition);if(!n)return;const r=`turbo-flow-element-${t.id}`;if(this.viewTransitionNames.add(r),e.push(`\n      #${t.id} {\n        view-transition-name: ${r};\n      }\n    `),n.viewTransitions){const{old:t,new:i}=n.viewTransitions;if(!t||!i)return;const o=`${r}-old`,s=`${r}-new`,a=this.generateKeyframes(o,t),c=this.generateKeyframes(s,i),l=n.duration||300,d=n.easing||"ease-out";e.push(`\n        ${a}\n        ${c}\n        ::view-transition-old(${r}) {\n          animation: ${o} ${l}ms ${d};\n        }\n        ::view-transition-new(${r}) {\n          animation: ${s} ${l}ms ${d};\n        }\n      `)}}generateKeyframes(t,e){return`@keyframes ${t} { ${Object.entries(e).map(([t,e])=>`${t} { ${Object.entries(e).map(([t,e])=>`${this.kebabCase(t)}: ${e};`).join(" ")} }`).join(" ")} }`}kebabCase(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}clear(){this.generated.clear(),this.viewTransitionNames.clear()}}class i{constructor(){this.styleElement=null,this.styleId="turbo-flow-styles",this.injectedCSS=new Map}inject(t,e=null){if(!t)return;const n=e?`${this.styleId}-${e}`:this.styleId;if(this.injectedCSS.has(n)){if(this.injectedCSS.get(n)===t)return}let r=document.getElementById(n);return r||(r=document.createElement("style"),r.id=n,r.setAttribute("data-turbo-flow","true"),document.head.appendChild(r)),r.textContent=t,this.injectedCSS.set(n,t),e||(this.styleElement=r),r}append(t,e=null){const n=e?`${this.styleId}-${e}`:this.styleId;let r=document.getElementById(n);if(!r)return this.inject(t,e);const i=(this.injectedCSS.get(n)||"")+"\n"+t;return r.textContent=i,this.injectedCSS.set(n,i),r}remove(t=null){const e=t?`${this.styleId}-${t}`:this.styleId,n=document.getElementById(e);n&&(n.remove(),this.injectedCSS.delete(e),t||this.styleElement!==n||(this.styleElement=null))}clear(){document.querySelectorAll('style[data-turbo-flow="true"]').forEach(t=>t.remove()),this.injectedCSS.clear(),this.styleElement=null}getInjectedCSS(t=null){const e=t?`${this.styleId}-${t}`:this.styleId;return this.injectedCSS.get(e)||null}hasInjectedCSS(t=null){const e=t?`${this.styleId}-${t}`:this.styleId;return this.injectedCSS.has(e)}update(t,e=null){return this.inject(t,e)}createMediaQueryWrapper(t,e){return`@media ${e} {\n${t}\n}`}injectForReducedMotion(t){const e=this.createMediaQueryWrapper(t,"(prefers-reduced-motion: reduce)");return this.inject(e,"reduced-motion")}cleanup(){const t=[];this.injectedCSS.forEach((e,n)=>{document.getElementById(n)||t.push(n)}),t.forEach(t=>{this.injectedCSS.delete(t)})}}const o=Object.freeze(Object.defineProperty({__proto__:null,fade:{name:"fade",duration:300,easing:"ease-out",viewTransitions:{old:{from:{opacity:1},to:{opacity:0}},new:{from:{opacity:0},to:{opacity:1}}},directions:{forward:null,back:null,none:null}},flip:{name:"flip",duration:400,easing:"ease-in-out",viewTransitions:{old:{from:{transform:"perspective(600px) rotateY(0deg)",opacity:1},to:{transform:"perspective(600px) rotateY(-90deg)",opacity:0}},new:{from:{transform:"perspective(600px) rotateY(90deg)",opacity:0},to:{transform:"perspective(600px) rotateY(0deg)",opacity:1}}},directions:{forward:{old:{from:{transform:"perspective(600px) rotateY(0deg)",opacity:1},to:{transform:"perspective(600px) rotateY(-90deg)",opacity:0}},new:{from:{transform:"perspective(600px) rotateY(90deg)",opacity:0},to:{transform:"perspective(600px) rotateY(0deg)",opacity:1}}},back:{old:{from:{transform:"perspective(600px) rotateY(0deg)",opacity:1},to:{transform:"perspective(600px) rotateY(90deg)",opacity:0}},new:{from:{transform:"perspective(600px) rotateY(-90deg)",opacity:0},to:{transform:"perspective(600px) rotateY(0deg)",opacity:1}}},none:{old:{from:{transform:"perspective(600px) rotateY(0deg)",opacity:1},to:{transform:"perspective(600px) rotateY(-45deg)",opacity:0}},new:{from:{transform:"perspective(600px) rotateY(45deg)",opacity:0},to:{transform:"perspective(600px) rotateY(0deg)",opacity:1}}}}},morph:{name:"morph",duration:400,easing:"cubic-bezier(0.4, 0, 0.2, 1)",viewTransitions:{old:{from:{opacity:1},to:{opacity:0}},new:{from:{opacity:0},to:{opacity:1}}},directions:{forward:null,back:null,none:null},requiresElement:!0,usesViewTransitionName:!0},slide:{name:"slide",duration:300,easing:"ease-out",viewTransitions:{old:{from:{transform:"translateX(0)",opacity:1},to:{transform:"translateX(-100%)",opacity:0}},new:{from:{transform:"translateX(100%)",opacity:0},to:{transform:"translateX(0)",opacity:1}}},directions:{forward:{old:{from:{transform:"translateX(0)",opacity:1},to:{transform:"translateX(-100%)",opacity:0}},new:{from:{transform:"translateX(100%)",opacity:0},to:{transform:"translateX(0)",opacity:1}}},back:{old:{from:{transform:"translateX(0)",opacity:1},to:{transform:"translateX(100%)",opacity:0}},new:{from:{transform:"translateX(-100%)",opacity:0},to:{transform:"translateX(0)",opacity:1}}},none:{old:{from:{transform:"translateX(0)",opacity:1},to:{transform:"translateX(-50%)",opacity:0}},new:{from:{transform:"translateX(50%)",opacity:0},to:{transform:"translateX(0)",opacity:1}}}}},slideDown:{name:"slide-down",duration:300,easing:"ease-out",viewTransitions:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(100%)",opacity:0}},new:{from:{transform:"translateY(-100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},directions:{forward:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(100%)",opacity:0}},new:{from:{transform:"translateY(-100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},back:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(-100%)",opacity:0}},new:{from:{transform:"translateY(100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},none:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(50%)",opacity:0}},new:{from:{transform:"translateY(-50%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}}}},slideUp:{name:"slide-up",duration:300,easing:"ease-out",viewTransitions:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(-100%)",opacity:0}},new:{from:{transform:"translateY(100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},directions:{forward:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(-100%)",opacity:0}},new:{from:{transform:"translateY(100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},back:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(100%)",opacity:0}},new:{from:{transform:"translateY(-100%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}},none:{old:{from:{transform:"translateY(0)",opacity:1},to:{transform:"translateY(-50%)",opacity:0}},new:{from:{transform:"translateY(50%)",opacity:0},to:{transform:"translateY(0)",opacity:1}}}}},zoom:{name:"zoom",duration:300,easing:"ease-out",viewTransitions:{old:{from:{transform:"scale(1)",opacity:1},to:{transform:"scale(1.1)",opacity:0}},new:{from:{transform:"scale(0.9)",opacity:0},to:{transform:"scale(1)",opacity:1}}},directions:{forward:{old:{from:{transform:"scale(1)",opacity:1},to:{transform:"scale(0.8)",opacity:0}},new:{from:{transform:"scale(1.2)",opacity:0},to:{transform:"scale(1)",opacity:1}}},back:{old:{from:{transform:"scale(1)",opacity:1},to:{transform:"scale(1.2)",opacity:0}},new:{from:{transform:"scale(0.8)",opacity:0},to:{transform:"scale(1)",opacity:1}}},none:{old:{from:{transform:"scale(1)",opacity:1},to:{transform:"scale(0.95)",opacity:0}},new:{from:{transform:"scale(1.05)",opacity:0},to:{transform:"scale(1)",opacity:1}}}}}},Symbol.toStringTag,{value:"Module"}));class s{constructor(o={}){this.config=new t(o),this.registry=new e,this.scanner=new n,this.generator=new r(this.registry),this.injector=new i,this.initialized=!1,this.currentTransition=null,this.navigationHistory=new Map,this.registerDefaultAnimations()}init(){return this.initialized?(console.warn("TurboFlow already initialized"),this):(this.scanner.setDefaultTransition(this.config.get("defaultTransition")),this.setupEventListeners(),this.injectBaseStyles(),this.initialized=!0,this)}configure(t){return this.config.update(t),this.scanner.setDefaultTransition(this.config.get("defaultTransition")),this.injectBaseStyles(),this}registerAnimation(t,e){return this.registry.register(t,e),this}registerDefaultAnimations(){Object.entries(o).forEach(([t,e])=>{this.registry.register(t,e)})}injectBaseStyles(){}setupEventListeners(){document.addEventListener("turbo:click",this.handleClick.bind(this)),document.addEventListener("turbo:submit-start",this.handleSubmitStart.bind(this)),document.addEventListener("turbo:before-visit",this.handleBeforeVisit.bind(this)),document.addEventListener("turbo:visit",this.handleVisit.bind(this)),document.addEventListener("turbo:before-render",this.handleBeforeRender.bind(this)),document.addEventListener("turbo:render",this.handleRender.bind(this)),document.addEventListener("turbo:load",this.handleLoad.bind(this)),document.addEventListener("turbo:before-frame-render",this.handleBeforeFrameRender.bind(this)),document.addEventListener("turbo:before-stream-render",this.handleBeforeStreamRender.bind(this))}handleRender(){this.config.get("debug")&&(console.log("TurboFlow: Render event fired"),console.log("TurboFlow: Current HTML classes during render:",document.documentElement.className),console.log("TurboFlow: data-turbo-visit-direction:",document.documentElement.getAttribute("data-turbo-visit-direction")))}handleClick(t){const e=t.target.closest("a[data-turbo-flow]");e&&(this.currentTransition=e.dataset.turboFlow,this.config.get("debug")&&console.log("TurboFlow: Click detected, transition:",this.currentTransition))}handleSubmitStart(t){const e=t.target;e&&e.dataset.turboFlow&&(this.currentTransition=e.dataset.turboFlow,this.config.get("debug")&&console.log("TurboFlow: Form submit detected, transition:",this.currentTransition))}handleBeforeVisit(t){if(!this.config.shouldAnimate())return;let e=this.currentTransition;if(!e){const n=document.querySelector(`a[href="${t.detail.url}"]`);e=(null==n?void 0:n.dataset.turboFlow)?n.dataset.turboFlow:this.config.get("defaultTransition")}this.pendingTransition=e,this.pendingUrl=t.detail.url,this.currentUrl=window.location.href,this.config.get("debug")&&console.log("TurboFlow: Before visit, storing transition:",e||this.config.get("defaultTransition"))}handleVisit(t){if(this.config.shouldAnimate()&&!this.pendingTransition){if("restore"===t.detail.action){const e=window.location.href,n=this.navigationHistory.get(e);n?(this.pendingTransition=n,this.pendingUrl=t.detail.url,this.config.get("debug")&&console.log("TurboFlow: Restore navigation detected, using stored transition:",n)):(this.pendingTransition=this.config.get("defaultTransition"),this.pendingUrl=t.detail.url,this.config.get("debug")&&console.log("TurboFlow: Restore navigation, no stored transition, using default"))}}}handleBeforeRender(t){if(this.pendingTransition){const t=document.documentElement.getAttribute("data-turbo-visit-direction");let e=this.pendingTransition;if("back"===t){const t=this.pendingUrl,n=this.navigationHistory.get(t);n&&(e=n,this.config.get("debug")&&console.log("TurboFlow: Back navigation, using stored transition:",n))}else if(this.currentUrl){if(this.navigationHistory.set(this.currentUrl,e),this.navigationHistory.size>50){const t=this.navigationHistory.keys().next().value;this.navigationHistory.delete(t)}this.config.get("debug")&&console.log("TurboFlow: Stored transition for leaving URL:",this.currentUrl,"→",e)}const n=this.generator.generate({links:[{transition:e}]});n&&(this.injector.inject(n,"turboflow-active-transition"),this.config.get("debug")&&console.log("TurboFlow: Injected CSS for transition:",e));const r=this.registry.list().map(t=>`turboflow-${t}`);document.documentElement.classList.remove(...r),document.documentElement.classList.add(`turboflow-${e}`),this.config.get("debug")&&(console.log("TurboFlow: Before render - Added class:",`turboflow-${e}`),console.log("TurboFlow: data-turbo-visit-direction:",t),console.log("TurboFlow: Navigation history size:",this.navigationHistory.size)),this.pendingTransition=null,this.pendingUrl=null,this.currentUrl=null}setTimeout(()=>{document.documentElement.classList.remove(...this.registry.list().map(t=>`turboflow-${t}`)),this.config.get("debug")&&console.log("TurboFlow: Cleaned up classes")},1e3)}handleLoad(){this.currentTransition=null,this.scanner.clearCache();const t=this.scanner.scan(document.body);if(t.targets&&t.targets.length>0){const e=t.targets.filter(t=>t.id&&t.transition&&("morph"===t.transition||this.registry.get(t.transition)));if(e.length>0){const t=this.generator.generate({targets:e});t&&(this.injector.inject(t,"element-transitions"),this.config.get("debug")&&console.log("TurboFlow: Generated CSS for element transitions:",e.map(t=>`${t.id}:${t.transition}`)))}}this.config.get("debug")&&console.log("TurboFlow: Page loaded, found elements:",t)}handleBeforeFrameRender(t){if(!this.config.shouldAnimate())return;const e=t.target,n=this.config.getFrameTransition(e.id);if(n){const t=this.generator.generate({frames:[{id:e.id,transition:n}]});t&&this.injector.inject(t,`frame-${e.id}`)}}handleBeforeStreamRender(t){if(!this.config.shouldAnimate())return;const e=t.detail.action,n=this.config.getStreamTransition(e);if(n){const t=this.generator.generate({streams:[{action:e,transition:n}]});t&&this.injector.inject(t,`stream-${e}`)}}destroy(){return document.removeEventListener("turbo:click",this.handleClick),document.removeEventListener("turbo:submit-start",this.handleSubmitStart),document.removeEventListener("turbo:before-visit",this.handleBeforeVisit),document.removeEventListener("turbo:visit",this.handleVisit),document.removeEventListener("turbo:before-render",this.handleBeforeRender),document.removeEventListener("turbo:load",this.handleLoad),document.removeEventListener("turbo:before-frame-render",this.handleBeforeFrameRender),document.removeEventListener("turbo:before-stream-render",this.handleBeforeStreamRender),this.injector.clear(),this.scanner.clearCache(),this.generator.clear(),this.navigationHistory.clear(),this.initialized=!1,this}}if("undefined"!=typeof window&&!window.TurboFlow){const t=()=>{window.TurboFlow=new s,window.TurboFlow.init()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}return s});
//# sourceMappingURL=turboflow.umd.js.map
